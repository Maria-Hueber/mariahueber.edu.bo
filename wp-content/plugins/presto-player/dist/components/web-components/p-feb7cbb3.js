import{g as n}from"./p-bd04895d.js";import{P as t}from"./p-e1e42b91.js";export default function(o){var r=o.config,e=o.selector,i=o.src,a=o.preload;return new Promise((function(o){if(window.Hls){if(window.Hls.isSupported()){var u,w=!["metadata","none"].includes(a);null!==(u=wp)&&void 0!==u&&u.blocks&&(w=!0);var p=new window.Hls({autoStartLoad:w});return p.loadSource(i),p.on(window.Hls.Events.LEVEL_SWITCHED,(function(n,t){e.closest(".presto-player__wrapper").querySelector(".plyr__menu__container [data-plyr='quality'][value='0'] span").innerHTML=p.autoLevelEnabled?"AUTO (".concat(p.levels[t.level].height,"p)"):"AUTO"})),void p.on(window.Hls.Events.MANIFEST_PARSED,(function(){var i=p.levels.map((function(n){return n.height}));i.unshift(0);var a=i.findIndex((function(n){var t;return n===parseInt(null===(t=prestoPlayer)||void 0===t?void 0:t.hls_start_level)}));p.startLevel=a?a-1:2,r.quality={default:0,options:i,forced:!0,onChange:function(n){0===n?prestoHLS.currentLevel=-1:prestoHLS.levels.forEach((function(t,o){t.height===n&&(console.log("Found quality match with "+n),prestoHLS.currentLevel=o)}))}},p.attachMedia(e),window.prestoHLS=p;var u=new t(e,n({},r));return u.hls=p,u.on("waiting",(function n(){p.startLoad(-1),u.off("waiting",n)})),u.on("languagechange",(function(){setTimeout((function(){return p.subtitleTrack=u.currentTrack}),50)})),o(u)}))}return o(new t(e,n({},r)))}}))}