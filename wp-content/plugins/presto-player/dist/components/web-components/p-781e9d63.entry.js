import{r as i,h as t,l as o,m as s}from"./p-defb92af.js";const e=class{constructor(t){i(this,t),this.show=!1,this.youtubeRenderKey=1}componentWillLoad(){this.handleDuration()}handleButtonCountChange(i,t){console.log(i),(null==i?void 0:i.button_count)!==(null==t?void 0:t.button_count)&&this.youtubeRenderKey++,(null==i?void 0:i.enabled)&&this.handleDuration()}handleDuration(){this.show=!!(null===window||void 0===window?void 0:window.wp.blocks)||function({current:i,duration:t,showAfter:o}){if(i===o)return!0;let s=i/t*100;return 99.9<s&&(s=100),s>=o}({current:this.currentTime,duration:this.duration,showAfter:this.config.percentage_start||0})}youtubeButton(){var i,o,s;if("youtube"===this.config.button_type&&(null===(i=this.youtube)||void 0===i?void 0:i.channelId))return t("presto-youtube-subscribe-button",{key:this.youtubeRenderKey,channel:null===(o=this.youtube)||void 0===o?void 0:o.channelId,showCount:null===(s=this.config)||void 0===s?void 0:s.button_count})}customButton(){var i,o,s,e,l,a,r,n;if("custom"===this.config.button_type)return t("presto-player-button",{type:"primary",size:"small",href:null===(o=null===(i=this.config)||void 0===i?void 0:i.button_link)||void 0===o?void 0:o.url,target:(null===(e=null===(s=this.config)||void 0===s?void 0:s.button_link)||void 0===e?void 0:e.opensInNewTab)?"_blank":"_self",style:Object.assign({"--presto-player-button-border-radius":`${null===(l=this.config)||void 0===l?void 0:l.button_radius}px`},(null===(a=this.config)||void 0===a?void 0:a.button_color)?{"--presto-player-button-color":`${null===(r=this.config)||void 0===r?void 0:r.button_color}`}:{})},null===(n=this.config)||void 0===n?void 0:n.button_text)}render(){var i,o;return t("presto-action-bar-ui",{open:this.show,style:{"--presto-action-bar-background":(null===(i=this.config)||void 0===i?void 0:i.background_color)||"#1d1d1d"}},null===(o=this.config)||void 0===o?void 0:o.text,t("div",{slot:"button"},this.youtubeButton(),this.customButton()))}get el(){return o(this)}static get watchers(){return{config:["handleButtonCountChange"],currentTime:["handleDuration"],duration:["handleDuration"]}}};e.style=":host{display:block}";const l=class{constructor(t){i(this,t)}componentWillLoad(){this.poster=this.poster||this.thumbnail}render(){return t("presto-video",{getRef:this.getRef,player:this.player,autoplay:this.autoplay,preload:this.preload,poster:this.poster,playsinline:this.playsinline,src:this.src,tracks:this.tracks})}},a=class{constructor(t){i(this,t),this.playVideo=s(this,"playVideo",7)}setStorage(i){window.localStorage.setItem("presto.videos.email_collection",JSON.stringify({[this.videoId]:i}))}getStorage(){return window.localStorage.getItem("presto.videos.email_collection")}componentWillLoad(){this.handleDuration()}timePassed({current:i,duration:t,showAfter:o}){if(i===o)return!0;let s=i/t*100;return 99.9<s&&(s=100),s>=o}handlePlayerInit(i,t){t||this.player.on("play playing timeupdate",(()=>{this.getStorage()||this.show&&this.player.pause()}))}handleDuration(){var i,t;this.enabled=!this.getStorage()&&(null===(t=null===(i=this.preset)||void 0===i?void 0:i.email_collection)||void 0===t?void 0:t.enabled),this.handleTime()}handleTime(){this.enabled&&(this.getStorage()||this.checkTime())}checkTime(){var i,t;this.show=this.timePassed({current:this.currentTime,duration:this.duration,showAfter:(null===(t=null===(i=this.preset)||void 0===i?void 0:i.email_collection)||void 0===t?void 0:t.percentage)||0})}async getNonce(){return fetch(`${window.prestoPlayer.ajaxurl}?action=presto_refresh_progress_nonce`)}async submit(i){this.loading=!0,this.error="";const t=await this.getNonce(),{data:o}=await t.json();try{let t=await fetch(window.prestoPlayer.ajaxurl,{method:"post",body:new URLSearchParams(Object.assign({action:"presto_player_email_submit",nonce:o,preset_id:this.preset.id,video_id:this.videoId},(null==i?void 0:i.detail)||{}))});const{success:s,data:e}=await t.json();if(!s)throw e;this.setStorage("collected"),this.show=!1,this.playVideo.emit()}catch(i){const t=null==i?void 0:i[0];t&&"string"==typeof t&&(this.error=t)}finally{this.loading=!1}}skip(){this.setStorage("skipped"),this.show=!1,this.playVideo.emit()}render(){var i,o,s,e,l,a,r,n,d,h,u;if(this.show)return t("presto-email-overlay-ui",{direction:this.direction,class:"email-overlay",headline:null===(o=null===(i=this.preset)||void 0===i?void 0:i.email_collection)||void 0===o?void 0:o.headline,defaultHeadline:null===(s=null==this?void 0:this.i18n)||void 0===s?void 0:s.emailDefaultHeadline,bottomText:null===(l=null===(e=this.preset)||void 0===e?void 0:e.email_collection)||void 0===l?void 0:l.bottom_text,allowSkip:null===(r=null===(a=this.preset)||void 0===a?void 0:a.email_collection)||void 0===r?void 0:r.allow_skip,skipText:null===(n=null==this?void 0:this.i18n)||void 0===n?void 0:n.skip,buttonText:null===(h=null===(d=this.preset)||void 0===d?void 0:d.email_collection)||void 0===h?void 0:h.button_text,placeholder:null===(u=null==this?void 0:this.i18n)||void 0===u?void 0:u.emailPlaceholder,isLoading:this.loading,errorMessage:this.error,onSubmitForm:i=>this.submit(i),onSkip:()=>this.skip()})}static get watchers(){return{player:["handlePlayerInit"],duration:["handleDuration"],currentTime:["handleTime"]}}};a.style=":host{display:block}";const r=class{constructor(t){i(this,t),this.playVideo=s(this,"playVideo",7)}render(){var i,o,s,e,l,a,r,n;return t("div",{class:"presto-player__muted-overlay",onClick:()=>{this.mutedPreview=!1,this.playVideo.emit()}},t("div",{class:"plyr__control plyr__control--overlaid","data-plyr":"play","aria-label":"Play",part:"muted-overlay-play"},t("svg",{id:"plyr-play",viewBox:"0 0 18 18"},t("path",{d:"M15.562 8.1L3.87.225c-.818-.562-1.87 0-1.87.9v15.75c0 .9 1.052 1.462 1.87.9L15.563 9.9c.584-.45.584-1.35 0-1.8z"})),t("span",{class:"plyr__sr-only"},"Play")),(null===(i=this.mutedOverlay)||void 0===i?void 0:i.enabled)&&(null===(o=this.mutedOverlay)||void 0===o?void 0:o.src)?t("div",{class:"presto-player__overlay is-image",part:"muted-overlay-image",style:{width:`${(null===(s=this.mutedOverlay)||void 0===s?void 0:s.width)||50}%`,left:100*((null===(l=null===(e=this.mutedOverlay)||void 0===e?void 0:e.focalPoint)||void 0===l?void 0:l.x)||.5)+"%",top:100*((null===(r=null===(a=this.mutedOverlay)||void 0===a?void 0:a.focalPoint)||void 0===r?void 0:r.y)||.5)+"%"}},t("img",{src:null===(n=this.mutedOverlay)||void 0===n?void 0:n.src,style:{transform:"translateX(-50%) translateY(-50%)"}})):"")}};r.style=":host{display:block}";const n=class{constructor(t){i(this,t)}getId(i){const t=/^.*(vimeo\.com\/)((channels\/[A-z]+\/)|(groups\/[A-z]+\/videos\/))?([0-9]+)/.exec(i||"");return(null==t?void 0:t[5])||""}render(){if(this.src)return t("div",{class:"plyr__video-embed",part:"embed",ref:this.getRef},t("iframe",{src:`https://player.vimeo.com/video/${this.getId(this.src)}?loop=false&amp;byline=false&amp;portrait=false&amp;title=false&amp;speed=true&amp;transparent=0&amp;gesture=media`,allowFullScreen:!0,allowTransparency:!0,allow:"autoplay"}))}};n.style=":host{display:block}";const d=class{constructor(t){i(this,t),this.reload=s(this,"reload",7)}handlePlayerChange(){this.player&&(this.player.ratio="16:9",this.fixes())}fixes(){this.player.on("statechange",(i=>{var t,o,s,e,l;1===i.detail.code&&((null===(l=null===(e=null===(s=null===(o=null===(t=null==i?void 0:i.detail)||void 0===t?void 0:t.plyr)||void 0===o?void 0:o.config)||void 0===s?void 0:s.blockAttributes)||void 0===e?void 0:e.mutedPreview)||void 0===l?void 0:l.enabled)||(this.player.muted=!1))}))}getId(i){var t;const o=(i||"").match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/);return o&&11===(null===(t=null==o?void 0:o[2])||void 0===t?void 0:t.length)?o[2]:null}loadPlayer(){this.lazyLoad=!1,this.reloadPlayer=!0}componentDidRender(){this.reloadPlayer&&(this.reloadPlayer=!1,this.reload.emit("play"))}setWebView(){var i;let t=null===(i=window.navigator)||void 0===i?void 0:i.standalone,o=window.navigator.userAgent.toLowerCase(),s=/safari/.test(o),e=/iphone|ipod|ipad/.test(o);this.isWebView=e?!t&&!s:o.includes("wv")}componentWillLoad(){if(this.setWebView(),this.poster||(this.poster=`//img.youtube.com/vi/${this.getId(this.src)}/maxresdefault.jpg`),this.lazyLoad){var i=window.navigator.userAgent;(i.match(/iPad/i)||i.match(/iPhone/i))&&(this.lazyLoad=!1)}}render(){return this.isWebView?t("div",{class:"fallback-container"},t("iframe",{src:this.src,allowFullScreen:!0,allowtransparency:!0,allow:"autoplay"})):this.lazyLoad?t("div",null,t("presto-video",{part:"video",getRef:this.getRef,poster:this.poster,src:""}),t("div",{class:"presto-player__play-cover",onClick:()=>this.loadPlayer()})):t("div",{class:"plyr__video-embed",part:"embed",ref:this.getRef,"data-plyr-provider":"youtube","data-plyr-embed-id":this.getId(this.src)})}static get watchers(){return{player:["handlePlayerChange"]}}};d.style=":host{display:block}.fallback-container{position:relative;padding-bottom:56.25%;padding-top:30px;height:0;overflow:hidden}.fallback-container iframe,.fallback-container object,.fallback-container embed{position:absolute;top:0;left:0;width:100%;height:100%}";export{e as presto_action_bar,l as presto_bunny,a as presto_email_overlay,r as presto_muted_overlay,n as presto_vimeo,d as presto_youtube}