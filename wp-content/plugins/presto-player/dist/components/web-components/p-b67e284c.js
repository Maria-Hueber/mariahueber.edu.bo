import{g as n}from"./p-defb92af.js";import{P as o}from"./p-d479bbb4.js";export default function(t){var r=t.config,e=t.selector,i=t.src,a=t.preload;return new Promise((function(t){if(window.Hls){if(window.Hls.isSupported()){var u,w=!["metadata","none"].includes(a);(null===(u=wp)||void 0===u?void 0:u.blocks)&&(w=!0);var d=new window.Hls({autoStartLoad:w});return d.loadSource(i),d.on(window.Hls.Events.LEVEL_SWITCHED,(function(n,o){e.closest(".presto-player__wrapper").querySelector(".plyr__menu__container [data-plyr='quality'][value='0'] span").innerHTML=d.autoLevelEnabled?"AUTO (".concat(d.levels[o.level].height,"p)"):"AUTO"})),void d.on(window.Hls.Events.MANIFEST_PARSED,(function(){var i=d.levels.map((function(n){return n.height}));i.unshift(0);var a=i.findIndex((function(n){var o;return n===parseInt(null===(o=prestoPlayer)||void 0===o?void 0:o.hls_start_level)}));d.startLevel=a?a-1:2,r.quality={default:0,options:i,forced:!0,onChange:function(n){0===n?prestoHLS.currentLevel=-1:prestoHLS.levels.forEach((function(o,t){o.height===n&&(console.log("Found quality match with "+n),prestoHLS.currentLevel=t)}))}},d.attachMedia(e),window.prestoHLS=d;var u=new o(e,n({},r));return u.hls=d,u.on("waiting",(function n(){d.startLoad(-1),u.off("waiting",n)})),u.on("languagechange",(function(){setTimeout((function(){return d.subtitleTrack=u.currentTrack}),50)})),t(u)}))}return t(new o(e,n({},r)))}}))}